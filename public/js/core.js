/**
 * Created by huyuxi on 15/5/12.
 */
if(typeof AppEngine=="undefined"){window.AppEngine={version:"3.5",UI:{},Form:{},App:{}};document.frame={btnDisabled:{}};window.AE=window.AppEngine}window.onerror=function(a,c,b){return true};if(!window.jQuery){alert("页面没有加载成功,请查看网络是否存在延迟!")}window.jq=window.jQuery;var onloadcallbacks=[];var debug=true;AE.ready=function(a){if(a){onloadcallbacks[onloadcallbacks.length]=a}};AE.event=function(e,c,d,b){var a=e;if(typeof e=="string"){a=$("#"+e)}$(a).bind(c,d)};AE.unevent=function(d,c,a){var b=d;if(typeof d=="string"){b=$("#"+d)}if(a){$(b).unbind(c,a)}else{$(b).unbind(c)}};$(document).ready(function(){if(AE.Form.bindType){AE.Form.bindType()}if(AE.Form.bindValidate){AE.Form.bindValidate()}if(onloadcallbacks){for(var a=0;a<onloadcallbacks.length;a++){try{onloadcallbacks[a].call()}catch(b){alert(b.message)}}}if(AE.Form.bindCss){AE.Form.bindCss()}var c=function(){return debug};$(document).oncontextmenu=c;$(document).onselectstart=c;$(document).oncut=c;$(document).ondrag=c;$(document).oncopy=c});AE.ServiceEx=function(serviceName,params,v_callback,options){var tranobject=null;if(params){tranobject=params||{};if(typeof params=="string"&&$("#"+params)){tranobject=Form.serialize(params,true)}}if(!tranobject.appid){tranobject.appid=window.top.frame_appid}try{var v_btnItem=(typeof(event)!="undefined"&&event&&event.srcElement&&event.srcElement.type&&(event.srcElement.type=="button"||event.srcElement.type=="submit"))?event.srcElement:null;var seqno=Utils.createUUID();var v_callServiceName=serviceName;if(v_callServiceName.indexOf("@")==-1&&options&&options.esb){v_callServiceName+=(options.esb.esbProtocol?("@ESB."+options.esb.esbProtocol):"@ESB")}$.ajax({url:"invoke.do",type:"post",data:{FRAMEserviceName:v_callServiceName,appid:tranobject.appid,FRAMEparams:Object.toJSON(tranobject||{}),FRAMEinvokeSeqno:seqno,FRAMEesbSeqno:(options&&options.esb&&options.esb.esbSeqno)?options.esb.esbSeqno:seqno},async:(options&&options.async)?options.async:false,beforeSend:function(jqXHR,settings){try{if(!options||!options.unShowWait){AE.UI.showwaitform()}if(v_btnItem!=null){if(!document.frame["btnDisabled"][v_btnItem]){document.frame["btnDisabled"][v_btnItem]=1;v_btnItem.disabled=true}else{document.frame["btnDisabled"][v_btnItem]=document.frame["btnDisabled"][v_btnItem]+1}}}catch(e){alert("ajax请求beforeSend时出现异常:"+e.message+":"+e.description)}},success:function(responseText){try{var data=null;if(responseText.indexOf("<html>")>=0||responseText.indexOf("</html>")>=0){window.location.href="session_out.do";return}if(responseText&&responseText!=""){data=eval("("+responseText+")")}if(data&&typeof data.code!="undefined"){var code=Number(data.code);if(code==0||code==1){if(code==1){alert("调用服务"+serviceName+"警告，警告信息："+data.text)}if(v_callback){v_callback.call(this,data.data,data.pageLimit)}}else{if(code<0){if(options&&options.ECallBack){options.ECallBack.call(this,data)}else{if(code==-1){alert(data.text)}else{if(code==-2){alert("系统异常，异常信息："+data.text)}else{if(code==-98){if(data.text){alert(data.text)}window.location.href="session_out.do";return}else{alert("调用服务"+serviceName+"异常，异常信息："+data.text)}}}}}else{alert(data.text)}}}}catch(e){alert("ajax请求success时出现异常:"+e.message+":"+e.description)}},error:function(jqXHR,textStatus,errorThrown){try{if(jqXHR.status==12029){if(confirm("服务器连接中断，是否关闭系统？")){var win=window.parent;while(win.name!="main"){win=win.parent}if(win.update_news){win.clearInterval(win.update_news);win.update_news=undefined}win.close()}}else{if(jqXHR.status==404){alert("【"+jqXHR.status+"】- 请查询请求的资源是否存活或已被锁定!")}else{if(jqXHR.status==0){}else{alert("【"+jqXHR.status+"】- 请求出错!")}}}}catch(e){alert("ajax请求error时出现异常:"+e.message+":"+e.description)}},complete:function(){try{if(document.body){if(!options||!options.unShowWait){AE.UI.hidewaitform()}if(v_btnItem!=null){try{document.frame["btnDisabled"][v_btnItem]=document.frame["btnDisabled"][v_btnItem]-1;if(document.frame["btnDisabled"][v_btnItem]==0){v_btnItem.disabled=false;if(!$(v_btnItem).is(":hidden")){v_btnItem.focus()}}}catch(se){v_btnItem.disabled=false;if(!$(v_btnItem).is(":hidden")){v_btnItem.focus()}}}}}catch(e){alert("ajax请求complete时出现异常:"+e.message+":"+e.description)}}})}catch(e){alert("请求服务过程,程序出现异常:"+e.message+":"+e.description)}};AppEngine.serialize=function(a){var e={};var d=function(i,g,f){if(i[g]){if(!Utils.isArray(i[g])){var h=i[g];i[g]=[];i[g].push(h)}i[g].push(f)}else{i[g]=f}};$.each($("#"+a+" input[type!='hidden'][type!='button'][type!='checkbox']").serializeArray(),function(f,g){if(g.name||g.id){d(e,(g.name?g.name:g.id),g.value)}});var b=$("#"+a+" input[type!='hidden'][type!='button'][likeQuery='true']");$.each(b,function(f,g){if(e[g.name]!=""){v_id=g.name==""?g.id:g.name;e[g.name]="%"+e[g.name]+"%"}});var c=$("#"+a+" input[type!='hidden'][type=checkbox]");$.each(c,function(f,g){if(g.name||g.id){d(e,(g.name?g.name:g.id),(g.checked?"1":"0"))}});return e};AppEngine.deserialize=function(a,b){if(!b){return}$.each($("#"+a+" input[type!='button']"),function(c,e){var d=b[(e.name||e.id)];if(d==null){return}if(e.type=="text"||e.type=="password"||e.type=="hidden"||e.type=="textarea"){e.value=d}else{if(e.type=="checkbox"){e.checked=(e.value==d||d=="1")}else{if(e.type=="radio"){if(e.value==d){e.checked=true;return}}else{if(e.type=="select-one"){$A(e.options).each(function(f){if(f.value==d){f.selected=true;return}})}}}}})};AE.Storage=function(a){return new LocalStorage(a)};